#!/usr/bin/env python

# linux-story
#
# Copyright (C) 2014, 2015 Kano Computing Ltd
# License: GNU General Public License v2 http://www.gnu.org/licenses/gpl-2.0.txt
#


import sys
import os
import signal

dir_path = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
if __name__ == '__main__' and __package__ is None:
    if dir_path != '/usr':
        sys.path.insert(1, dir_path)
from linux_story.launch_functions import launch_project
from kano_profile.apps import load_app_state_variable


if __name__ == "__main__":
    def sigint_handler(signum, frame):
        pass

    signal.signal(signal.SIGINT, sigint_handler)

    # Arguments are pipe filename, and then optionally
    # the Challenge and Step numbers
    if len(sys.argv) == 3:
        launch_project(sys.argv[1], sys.argv[2])

    elif len(sys.argv) == 2:
        launch_project(sys.argv[1], '1')

    elif len(sys.argv) == 1:
        challenge = 1
        profile_level = load_app_state_variable("linux-story", "level")
        if profile_level:
            challenge = profile_level + 1

        # If the project was completed previously, just start over
        if challenge > 15:
            challenge = 1

        launch_project(str(challenge), '1')
    else:
        sys.exit("Wrong number of arguments!")
